<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUB Education - Funding Tracker</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’°</text></svg>">
    <style>
        :root {
            --primary: #6546c8;
            --primary-dark: #4a2fa0;
            --accent: #F8D32A;
            --accent-dark: #d4b41e;
            --success: #276749;
            --warning: #c05621;
            --light: #faf9fc;
            --border: #e8e4f0;
            --text: #2d2d3d;
            --text-light: #6b6b80;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light);
            color: var(--text);
            line-height: 1.6;
            padding: 1rem;
        }
        .top-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }
        .left-column {
            min-width: 0;
        }
        .right-column {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .brand-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1.5rem 2rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        .brand-logo {
            font-size: 2rem;
            font-weight: 800;
            color: var(--accent);
            text-decoration: none;
            letter-spacing: -0.5px;
            white-space: nowrap;
        }
        .brand-logo:hover {
            color: white;
        }
        .brand-info {
            flex: 1;
        }
        .brand-info p {
            opacity: 0.85;
            font-size: 0.85rem;
        }
        header {
            background: white;
            color: var(--text);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
            border-left: 4px solid var(--primary);
        }
        header h1 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }
        .subtitle {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        .stats {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        .stat {
            background: var(--light);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.85rem;
            border: 1px solid var(--border);
        }
        .stat strong {
            font-size: 1.2rem;
            color: var(--primary);
        }
        .section {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
            border: 1px solid var(--border);
        }
        .section h2 {
            color: var(--primary);
            font-size: 1.1rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
        }
        .section.applied {
            border-left: 4px solid var(--success);
        }
        .section.applied h2 {
            color: var(--success);
        }
        .section.irrelevant {
            border-left: 4px solid #a0aec0;
        }
        .section.irrelevant h2 {
            color: #718096;
        }
        .job-list {
            list-style: none;
        }
        .job {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }
        .job:last-child {
            border-bottom: none;
        }
        .job-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 0.5rem;
        }
        .job-title {
            font-weight: 600;
            color: var(--primary);
            text-decoration: none;
            flex: 1;
        }
        .job-title:hover {
            text-decoration: underline;
            color: var(--primary-dark);
        }
        .job-actions {
            display: flex;
            gap: 0.25rem;
            flex-shrink: 0;
        }
        .btn {
            padding: 0.25rem 0.5rem;
            border: none;
            border-radius: 4px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .btn:hover {
            opacity: 0.8;
        }
        .btn-applied {
            background: #c6f6d5;
            color: var(--success);
        }
        .btn-irrelevant {
            background: #e2e8f0;
            color: #718096;
        }
        .btn-undo {
            background: #fed7d7;
            color: #c53030;
        }
        .job-meta {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 0.5rem;
        }
        .badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .badge-high {
            background: #fed7d7;
            color: #c53030;
        }
        .badge-closing {
            background: #feebc8;
            color: var(--warning);
        }
        .badge-keyword {
            background: #e9e4f5;
            color: var(--primary);
        }
        .keywords {
            margin-top: 0.5rem;
            display: flex;
            gap: 0.25rem;
            flex-wrap: wrap;
        }
        .empty {
            color: #a0aec0;
            text-align: center;
            padding: 1rem;
            font-size: 0.9rem;
        }
        footer {
            text-align: center;
            color: var(--text-light);
            font-size: 0.8rem;
            margin-top: 2rem;
        }
        footer a {
            color: var(--primary);
        }
        .right-job {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.85rem;
        }
        .right-job:last-child {
            border-bottom: none;
        }
        .right-job-title {
            font-weight: 500;
            color: var(--primary);
            text-decoration: none;
            display: block;
            margin-bottom: 0.25rem;
        }
        .right-job-title:hover {
            text-decoration: underline;
        }
        .right-job-meta {
            font-size: 0.75rem;
            color: var(--text-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        @media (max-width: 900px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            .right-column {
                order: -1;
            }
        }
        @media (max-width: 600px) {
            body {
                padding: 0.5rem;
            }
            .brand-header {
                flex-direction: column;
                text-align: center;
                padding: 1rem;
            }
            header {
                padding: 1rem;
            }
            .job-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
            .job-header {
                flex-direction: column;
            }
            .job-actions {
                align-self: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="top-container">
        <div class="brand-header">
            <a href="https://qub.education/" target="_blank" class="brand-logo">QUB</a>
            <div class="brand-info">
                <p>Educatia este conectare &mdash; STEAM Education &amp; Community in Cluj-Napoca</p>
            </div>
        </div>
        <header>
            <h1>Funding &amp; Grant Tracker</h1>
            <p class="subtitle">Oportunitati de finantare pentru ONG-uri din Romania</p>
            <p class="subtitle">Focus: Educatie, STEAM, Tineret, Cultura, Societate Civila</p>
            <div class="stats">
                <div class="stat"><strong id="stat-total">27</strong> oportunitati</div>
                <div class="stat"><strong id="stat-closing">0</strong> termen apropiat</div>
                <div class="stat"><strong id="stat-high">17</strong> prioritate ridicata</div>
            </div>
        </header>
    </div>

    <div class="main-layout">
        <div class="left-column" id="main-jobs">
            <div class="section"><p class="empty">Se incarca...</p></div>
        </div>
        <div class="right-column">
            <div class="section applied">
                <h2>Aplicate (<span id="applied-count">0</span>)</h2>
                <ul class="job-list" id="applied-list">
                    <li class="empty" id="applied-empty">Nicio aplicare inca</li>
                </ul>
            </div>
            <div class="section irrelevant">
                <h2>Irelevante (<span id="irrelevant-count">0</span>)</h2>
                <ul class="job-list" id="irrelevant-list">
                    <li class="empty" id="irrelevant-empty">Nimic marcat</li>
                </ul>
            </div>
        </div>
    </div>

    <footer>
        <p>Ultima actualizare: 2026-02-06 19:51 CET</p>
        <p>Notificari: <a href="https://ntfy.sh/qub-ngo-funding">ntfy.sh/qub-ngo-funding</a></p>
        <p style="margin-top: 0.5rem;"><a href="https://qub.education/" target="_blank">qub.education</a></p>
        <p id="sync-status" style="font-size: 0.7rem; margin-top: 0.5rem; color: #718096;"></p>
    </footer>

    <script>
        const allJobs = [{"id": "finantare_ro_c065ffe8e5ac", "title": "Start-up Nation 2017: Cei care au PFA vor putea obtine, pe o firma noua, pana la 200.000 RON de la stat", "url": "https://www.finantare.ro/start-up-nation-2017-cei-care-au-pfa-vor-putea-obtine-pe-o-firma-noua-pana-la-200-000-ron-de-la-stat-promovarea-pe-internet-eligibila.html", "deadline": null, "deadline_date": null, "source": "finantare_ro", "matched_keywords": ["nerambursabil", "tehnologie"], "is_high_priority": true, "closing_soon": false}, {"id": "finantare_ro_33fcc615524f", "title": "MFE: POSDRU 2007-2013 ar putea fi deblocat in mai-iunie", "url": "https://www.finantare.ro/mfe-posdru-2007-2013-ar-putea-fi-deblocat-in-mai-iunie.html", "deadline": null, "deadline_date": null, "source": "finantare_ro", "matched_keywords": ["incluziune"], "is_high_priority": false, "closing_soon": false}, {"id": "finantare_ro_c67eeffaddad", "title": "Calendar fonduri europene 2026: aproape 300 de sesiuni de finan\u021bare, buget de 6,6 miliarde euro", "url": "https://www.finantare.ro/calendar-fonduri-europene-2026-aproape-300-de-sesiuni-de-finantare-buget-de-66-miliarde-euro.html", "deadline": null, "deadline_date": null, "source": "finantare_ro", "matched_keywords": ["ong"], "is_high_priority": true, "closing_soon": false}, {"id": "finantare_ro_cb89c0b245c4", "title": "Firm\u0103 de consultan\u021b\u0103 din Bra\u0219ov acuzat\u0103 c\u0103 a \u00een\u0219elat peste 160 de antreprenori cu promisiuni de fonduri UE", "url": "https://www.finantare.ro/firma-de-consultanta-din-brasov-acuzata-ca-a-inselat-peste-160-de-antreprenori-cu-promisiuni-de-fonduri-ue.html", "deadline": null, "deadline_date": null, "source": "finantare_ro", "matched_keywords": ["granturi"], "is_high_priority": true, "closing_soon": false}, {"id": "finantare_ro_73634f66dc5e", "title": "1 milion euro pentru programe de sprijin startup-uri \u00een Republica Moldova", "url": "https://www.finantare.ro/1-milion-euro-pentru-programe-de-sprijin-startup-uri-in-republica-moldova.html", "deadline": null, "deadline_date": null, "source": "finantare_ro", "matched_keywords": ["granturi"], "is_high_priority": true, "closing_soon": false}, {"id": "finantare_ro_c93161239da9", "title": "Finan\u021b\u0103ri de p\u00e2n\u0103 la 300.000 euro pentru micro\u00eentreprinderi din Regiunea Nord-Est \u2013 Apel 2 \u00een consultare public\u0103", "url": "https://www.finantare.ro/finantari-de-pana-la-300-000-euro-pentru-microintreprinderi-din-regiunea-nord-est-apel-2-in-consultare-publica.html", "deadline": "13 martie 2026", "deadline_date": "2026-03-13T00:00:00", "source": "finantare_ro", "matched_keywords": ["digitalizare"], "is_high_priority": false, "closing_soon": false}, {"id": "finantare_ro_4d68bd4b34a2", "title": "POCU: Ghidul \u201eM\u0103suri pentru tinerii NEET II- Subven\u021bionarea locurilor de munc\u0103\u201d", "url": "https://www.finantare.ro/pocu-ghidul-masuri-pentru-tinerii-neet-ii-subventionarea-locurilor-de-munca.html", "deadline": "15 septembrie 2022", "deadline_date": "2022-09-15T00:00:00", "source": "finantare_ro", "matched_keywords": ["tineri"], "is_high_priority": true, "closing_soon": false}, {"id": "finantare_ro_990ab83cb013", "title": "MIPE lanseaz\u0103 procesul de constituire a Comitetului de Monitorizare pentru POEO \u0219i pentru POIDS", "url": "https://www.finantare.ro/mipe-lanseaza-procesul-de-constituire-a-comitetului-de-monitorizare-pentru-poeo-si-pentru-poids.html", "deadline": null, "deadline_date": null, "source": "finantare_ro", "matched_keywords": ["incluziune"], "is_high_priority": false, "closing_soon": false}, {"id": "finantare_ro_1c3de48391ae", "title": "Dezvoltarea capacit\u0103\u021bii ONG-urilor mici sau f\u0103r\u0103 experien\u021b\u0103 din Regiunile Sud-Vest Oltenia, Sud-Muntenia \u0219i Sud-Est -Incubator ONG", "url": "https://www.finantare.ro/dezvoltarea-capacitatii-ong-urilor-mici-sau-fara-experienta-din-regiunile-sud-vest-oltenia-sud-muntenia-si-sud-est-incubator-ong.html", "deadline": null, "deadline_date": null, "source": "finantare_ro", "matched_keywords": ["ong", "capacitare", "comunitate"], "is_high_priority": true, "closing_soon": false}, {"id": "finantare_ro_4fc23da3e283", "title": "RO-ACTIVECITIZENS: Civic participation in response to the Ukraine crisis (Rapid response grants for Ukraine crisis) Single round", "url": "https://www.finantare.ro/ro-activecitizens-civic-participation-in-response-to-the-ukraine-crisis-rapid-response-grants-for-ukraine-crisis-single-round.html", "deadline": null, "deadline_date": null, "source": "finantare_ro", "matched_keywords": ["youth", "civil society", "civic"], "is_high_priority": true, "closing_soon": false}, {"id": "finantare_ro_8e96cae0761d", "title": "Call for Africa \u2013 Europe Collaborative Research & Innovation projects on Renewable Energy (LEAP-RE)", "url": "https://www.finantare.ro/call-for-africa-europe-collaborative-research-innovation-projects-on-renewable-energy-leap-re.html", "deadline": null, "deadline_date": null, "source": "finantare_ro", "matched_keywords": ["inovare", "innovation"], "is_high_priority": false, "closing_soon": false}, {"id": "finantare_ro_c9a173d3ac2c", "title": "Oportunitate pentru angaja\u021bi: curs online GRATUIT de Inteligen\u021b\u0103 Artificial\u0103", "url": "https://www.finantare.ro/oportunitate-pentru-angajati-curs-online-gratuit-de-inteligenta-artificiala.html", "deadline": null, "deadline_date": null, "source": "finantare_ro", "matched_keywords": ["tehnologie"], "is_high_priority": false, "closing_soon": false}, {"id": "finantare_ro_3cd0fd31fa42", "title": "Ia\u0219i devine centrul inova\u021biei medicale \u0219i tehnologice. HealthTech Connect, 20\u201324 octombrie 2025", "url": "https://www.finantare.ro/iasi-devine-centrul-inovatiei-medicale-si-tehnologice-healthtech-connect-20-24-octombrie-2025.html", "deadline": null, "deadline_date": null, "source": "finantare_ro", "matched_keywords": ["inovare", "tehnologie"], "is_high_priority": false, "closing_soon": false}, {"id": "afcn_6d967e47e071", "title": "\u00bb S-au publicat listele proiectelor culturale selectate pentru acordarea finan\u021b\u0103rilor, dup\u0103 etapa I de evaluare, in sesiunea de finan\u021bare proiecte culturale I/2013", "url": "https://www.afcn.ro/stiri/S-au-publicat-listele-proiectelor-culturale-selectate-pentru-acordarea-finan-rilor-dup-etapa-I-de-evaluare-in-sesiunea-de-finan-are-proiecte-culturale-I-2013-67.html", "deadline": "1 septembrie            2022", "deadline_date": "2022-09-01T00:00:00", "source": "afcn", "matched_keywords": ["cultura", "cultural", "culturale"], "is_high_priority": false, "closing_soon": false}, {"id": "afcn_6c01090beeb3", "title": "\u00bb Invitatie pentru evaluarea proiectelor culturale 2013", "url": "https://www.afcn.ro/stiri/Invitatie-pentru-evaluarea-proiectelor-culturale-2013-72.html", "deadline": "1 septembrie            2022", "deadline_date": "2022-09-01T00:00:00", "source": "afcn", "matched_keywords": ["cultura", "cultural", "culturale"], "is_high_priority": false, "closing_soon": false}, {"id": "fdsc_0f9d3cc6240b", "title": "Programe \u0219i proiecte", "url": "https://www.fdsc.ro/programe/", "deadline": null, "deadline_date": null, "source": "fdsc", "matched_keywords": ["ong", "grant", "granturi", "inovare", "capacitare", "civic", "civica"], "is_high_priority": true, "closing_soon": false}, {"id": "fdsc_e33b620c5c24", "title": "C\u0103ut\u0103m un/o Specialist/\u0103/x \u00een Programe de Finan\u021bare", "url": "https://www.fdsc.ro/cautam-un-o-specialist-a-x-in-programe-de-finantare/", "deadline": "16 ianuarie 2026", "deadline_date": "2026-01-16T00:00:00", "source": "fdsc", "matched_keywords": ["ong", "civil society", "capacitare", "incluziune"], "is_high_priority": true, "closing_soon": false}, {"id": "fdsc_02e24835f94b", "title": "Elve\u021bia \u0219i Rom\u00e2nia au marcat lansarea Programului de Implicare Civic\u0103 \u2013 un pas important pentru consolidarea societ\u0103\u021bii civile din Rom\u00e2nia", "url": "https://www.fdsc.ro/elvetia-si-romania-au-marcat-lansarea-programului-de-implicare-civica-un-pas-important-pentru-consolidarea-societatii-civile-din-romania-2/", "deadline": null, "deadline_date": null, "source": "fdsc", "matched_keywords": ["capacitare", "civic"], "is_high_priority": false, "closing_soon": false}, {"id": "fdsc_afb650148566", "title": "Programul de Implicare Civic\u0103 lanseaz\u0103 Apelul 2: granturi pentru proiecte cu impact local sau na\u021bional", "url": "https://www.fdsc.ro/programul-de-implicare-civica-lanseaza-apelul-2-granturi-pentru-proiecte-cu-impact-local-sau-national-2/", "deadline": null, "deadline_date": null, "source": "fdsc", "matched_keywords": ["ong", "granturi", "capacitare"], "is_high_priority": true, "closing_soon": false}, {"id": "fdsc_cc3b29ab8db0", "title": "Afl\u0103 mai multe", "url": "https://www.fdsc.ro/Programe_Proiecte/programul-cantonului-basel-stadt-in-romania/", "deadline": null, "deadline_date": null, "source": "fdsc", "matched_keywords": ["capacitare"], "is_high_priority": false, "closing_soon": false}, {"id": "fdsc_71e10abe42b9", "title": "Afl\u0103 mai multe", "url": "https://www.fdsc.ro/Programe_Proiecte/raf-programul-efectiv-civic/", "deadline": null, "deadline_date": null, "source": "fdsc", "matched_keywords": ["tineri", "copii", "ong", "capacitare", "civic"], "is_high_priority": true, "closing_soon": false}, {"id": "active_citizens_6fff312a0e84", "title": "Harta apelurilor", "url": "https://activecitizensfund.ro/harta-apelurilor/", "deadline": null, "deadline_date": null, "source": "active_citizens", "matched_keywords": ["ong"], "is_high_priority": true, "closing_soon": false}, {"id": "active_citizens_e0d529635755", "title": "Apeluri \u00eenchise", "url": "https://activecitizensfund.ro/apeluri-inchise/", "deadline": null, "deadline_date": null, "source": "active_citizens", "matched_keywords": ["grant", "civic"], "is_high_priority": true, "closing_soon": false}, {"id": "active_citizens_5bba5dbc9577", "title": "Proiecte \u00een evaluare", "url": "https://activecitizensfund.ro/proiecte-in-evaluare/", "deadline": null, "deadline_date": null, "source": "active_citizens", "matched_keywords": ["granturi", "civic"], "is_high_priority": true, "closing_soon": false}, {"id": "active_citizens_283928e7c4e6", "title": "Programul3", "url": "https://activecitizensfund.ro/trillenials/", "deadline": null, "deadline_date": null, "source": "active_citizens", "matched_keywords": ["tineri", "civic"], "is_high_priority": true, "closing_soon": false}, {"id": "ngohub_5e12716a7d52", "title": "Funding Call", "url": "https://www.ngohub.ro/ro/funding-call", "deadline": null, "deadline_date": null, "source": "ngohub", "matched_keywords": ["ong", "ngo", "grant"], "is_high_priority": true, "closing_soon": false}, {"id": "ngohub_b87377070127", "title": "Programe UE pentru tineri", "url": "https://www.eurodesk.ro/pag-3", "deadline": null, "deadline_date": null, "source": "ngohub", "matched_keywords": ["tineret", "tineri", "incluziune", "voluntariat"], "is_high_priority": true, "closing_soon": false}];
        const sourceNames = {
            'finantare_ro': 'Finantare.ro',
            'fonduri_structurale': 'Fonduri Structurale EU',
            'afcn': 'AFCN - Fondul Cultural National',
            'fdsc': 'FDSC',
            'active_citizens': 'Active Citizens Fund',
            'ngohub': 'NGO Hub / Eurodesk'
        };

        // Supabase config
        const SUPABASE_URL = 'https://fydclxflriuwbsmnizij.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ5ZGNseGZscml1d2JzbW5pemlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0MDI0MzQsImV4cCI6MjA4NTk3ODQzNH0.ZGmA9gHrb5A-ZRLUMlPf2zjm9-OhB3QUbXO6JRFG1dU';

        let applied = [];
        let irrelevant = [];
        let saveTimeout = null;

        function setSyncStatus(msg) {
            document.getElementById('sync-status').textContent = msg;
        }

        async function loadState() {
            setSyncStatus('Se incarca...');
            try {
                const res = await fetch(`${SUPABASE_URL}/rest/v1/funding_state?id=eq.default&select=applied,irrelevant`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                if (res.ok) {
                    const data = await res.json();
                    if (data.length > 0) {
                        applied = data[0].applied || [];
                        irrelevant = data[0].irrelevant || [];
                    }
                    setSyncStatus('Sincronizat');
                } else {
                    throw new Error('Failed to load');
                }
            } catch (e) {
                console.error('Load error:', e);
                setSyncStatus('Offline - date locale');
                applied = JSON.parse(localStorage.getItem('qub-funding-applied') || '[]');
                irrelevant = JSON.parse(localStorage.getItem('qub-funding-irrelevant') || '[]');
            }
            render();
        }

        function saveState() {
            // Always save to localStorage as backup
            localStorage.setItem('qub-funding-applied', JSON.stringify(applied));
            localStorage.setItem('qub-funding-irrelevant', JSON.stringify(irrelevant));

            // Debounce cloud save
            if (saveTimeout) clearTimeout(saveTimeout);
            setSyncStatus('Se salveaza...');
            saveTimeout = setTimeout(async () => {
                try {
                    const res = await fetch(`${SUPABASE_URL}/rest/v1/funding_state?id=eq.default`, {
                        method: 'PATCH',
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`,
                            'Content-Type': 'application/json',
                            'Prefer': 'return=minimal'
                        },
                        body: JSON.stringify({ applied, irrelevant })
                    });
                    if (res.ok) {
                        setSyncStatus('Sincronizat');
                    } else {
                        throw new Error('Save failed');
                    }
                } catch (e) {
                    console.error('Save error:', e);
                    setSyncStatus('Eroare sincronizare - salvat local');
                }
            }, 500);
        }

        function formatDate(dateStr) {
            if (!dateStr) return 'Nespecificat';
            try {
                const date = new Date(dateStr);
                if (isNaN(date.getTime())) return dateStr;
                return date.toLocaleDateString('ro-RO', { day: '2-digit', month: 'short', year: 'numeric' });
            } catch {
                return dateStr;
            }
        }

        function createJobCard(job) {
            const badges = [];
            if (job.is_high_priority) badges.push('<span class="badge badge-high">Prioritate Ridicata</span>');
            if (job.closing_soon) badges.push('<span class="badge badge-closing">Termen Apropiat</span>');

            const keywords = job.matched_keywords.slice(0, 5).map(k => `<span class="badge badge-keyword">${k}</span>`).join('');
            const deadline = formatDate(job.deadline_date || job.deadline);

            const actions = `
                <button class="btn btn-applied" onclick="markApplied('${job.id}')">Aplicat</button>
                <button class="btn btn-irrelevant" onclick="markIrrelevant('${job.id}')">Irelevant</button>
            `;

            return `
                <li class="job" data-job-id="${job.id}">
                    <div class="job-header">
                        <a href="${job.url}" class="job-title" target="_blank">${job.title}</a>
                        <div class="job-actions">${actions}</div>
                    </div>
                    <div class="job-meta">
                        <span>Termen: ${deadline}</span>
                        ${badges.join(' ')}
                    </div>
                    <div class="keywords">${keywords}</div>
                </li>
            `;
        }

        function createRightJobCard(job, listType) {
            const deadline = formatDate(job.deadline_date || job.deadline);
            return `
                <li class="right-job" data-job-id="${job.id}">
                    <a href="${job.url}" class="right-job-title" target="_blank">${job.title}</a>
                    <div class="right-job-meta">
                        <span>${deadline}</span>
                        <button class="btn btn-undo" onclick="undoJob('${job.id}', '${listType}')">Anuleaza</button>
                    </div>
                </li>
            `;
        }

        function markApplied(jobId) {
            if (!applied.includes(jobId)) {
                applied.push(jobId);
                irrelevant = irrelevant.filter(id => id !== jobId);
                saveState();
                render();
            }
        }

        function markIrrelevant(jobId) {
            if (!irrelevant.includes(jobId)) {
                irrelevant.push(jobId);
                applied = applied.filter(id => id !== jobId);
                saveState();
                render();
            }
        }

        function undoJob(jobId, listType) {
            if (listType === 'applied') {
                applied = applied.filter(id => id !== jobId);
            } else {
                irrelevant = irrelevant.filter(id => id !== jobId);
            }
            saveState();
            render();
        }

        function render() {
            const mainJobs = allJobs.filter(j => !applied.includes(j.id) && !irrelevant.includes(j.id));
            const appliedJobs = allJobs.filter(j => applied.includes(j.id));
            const irrelevantJobs = allJobs.filter(j => irrelevant.includes(j.id));

            const bySource = {};
            mainJobs.forEach(job => {
                if (!bySource[job.source]) bySource[job.source] = [];
                bySource[job.source].push(job);
            });

            const mainContainer = document.getElementById('main-jobs');
            if (mainJobs.length === 0) {
                mainContainer.innerHTML = '<div class="section"><p class="empty">Nu s-au gasit oportunitati de finantare. Verificati mai tarziu!</p></div>';
            } else {
                let html = '';
                for (const [source, jobs] of Object.entries(bySource)) {
                    const sourceName = sourceNames[source] || source;
                    html += `<div class="section"><h2>${sourceName} (${jobs.length})</h2><ul class="job-list">`;
                    jobs.forEach(job => {
                        html += createJobCard(job);
                    });
                    html += '</ul></div>';
                }
                mainContainer.innerHTML = html;
            }

            const appliedList = document.getElementById('applied-list');
            document.getElementById('applied-count').textContent = appliedJobs.length;
            if (appliedJobs.length === 0) {
                appliedList.innerHTML = '<li class="empty">Nicio aplicare inca</li>';
            } else {
                appliedList.innerHTML = appliedJobs.map(j => createRightJobCard(j, 'applied')).join('');
            }

            const irrelevantList = document.getElementById('irrelevant-list');
            document.getElementById('irrelevant-count').textContent = irrelevantJobs.length;
            if (irrelevantJobs.length === 0) {
                irrelevantList.innerHTML = '<li class="empty">Nimic marcat</li>';
            } else {
                irrelevantList.innerHTML = irrelevantJobs.map(j => createRightJobCard(j, 'irrelevant')).join('');
            }

            document.getElementById('stat-total').textContent = mainJobs.length;
            document.getElementById('stat-closing').textContent = mainJobs.filter(j => j.closing_soon).length;
            document.getElementById('stat-high').textContent = mainJobs.filter(j => j.is_high_priority).length;
        }

        loadState();
    </script>
</body>
</html>
